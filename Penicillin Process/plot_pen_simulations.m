function plot_pen_simulations()


pen_simulator = @penicillin_process_simulator;

%current operating point


sampling = [0:6:8*24];
opt=odeset('RelTol',1e-6,'AbsTol',1e-8);

%Initial substrate concentration
S0_initial = 0.1;

%Initial flowrate
F_initial = 0.01;

%Initial volume
vol_initial = 100;

%Initial biomass
bio_initial = 0.1;

%Initial penicillin
pen_initial = 0;

%Initial process conditions
Y_initial = [bio_initial pen_initial S0_initial vol_initial];

Y0 = Y_initial;

U(1) = 50; 
U(2) = 0.1728;
Y0(3) = U(1);



K_sim=[0.092 0.15 0.005 0.0002 0.1 0.04 0.45 0.9 0.014];

sf_inlet = 600;
extra_var = [sf_inlet];

U_wo_mat = [0.1	0.1	0.1	0.1	0.1	0.1	0.1	0.1	0.1	0.1
27.233	35.3154	28.3893	28.394	37.5562	25.1898	31.8906	31.4876	26.4857	42.8399
29.0931	44.0201	37.9783	24.5766	42.0367	33.8393	28.8362	31.2886	36.0038	44.3859
35.8698	42.3869	42.2635	23.3823	47.5997	43.3397	35.0975	40.3768	40.7179	50.6858
32.0068	44.5525	47.4642	29.9947	52.3417	46.9463	32.0871	41.1359	45.4125	55.3538
36.657	43.7323	52.8301	33.8447	49.1272	47.6595	39.1862	45.191	49.0763	53.1338
37.2101	46.982	49.37	37.8543	53.7867	51.7173	40.7005	46.0909	48.6711	54.6646
40.4209	49.1062	43.813	39.2688	52.9002	51.0151	46.3454	49.1974	48.2061	56.0745
38.3643	50.9889	48.1488	43.2047	48.0773	48.4534	42.0164	48.5353	51.5015	54.1667
36.3762	52.7099	45.4677	46.502	51.0885	49.9831	48.4872	50.9751	49.2417	54.1795
38.9669	56.7852	46.0742	48.8576	56.0049	50.1138	50.2184	52.8304	45.8762	51.7325
43.2524	52.6027	43.4231	49.1344	54.0678	53.3061	53.7538	54.115	48.6408	54.6549
43.2079	52.1111	48.4617	48.098	58.7062	55.5566	54.2476	54.3341	46.4441	52.4325
46.5302	55.6144	42.8408	51.7236	57.2927	54.8639	59.059	54.2166	44.6544	49.5859
51.8211	56.2729	48.8899	53.2325	55.8497	55.348	54.4724	53.0993	45.12	52.589
52.2987	57.4072	47.03	49.2532	60.3112	51.9856	58.655	50.363	48.6821	53.8331
51.4846	60.8363	48.893	52.4126	58.8533	55.4635	54.0122	53.5098	44.8762	50.4577
54.5807	58.5207	52.3907	55.7438	57.957	57.987	52.5697	50.3352	46.3924	48.7816
57.6345	62.374	49.8011	52.9972	60.9975	61.1553	48.1387	51.5337	49.888	52.7731
61.0573	66.1122	50.6224	53.0889	61.1648	59.4845	50.9121	49.6467	49.6439	49.9517
59.9069	52.7209	49.5096	56.0073	60.0342	59.5864	55.3986	49.0616	51.7259	46.5833
55.9792	67.2529	50.1816	54.231	58.0537	63.2397	62.2549	47.1944	51.6618	43.5313
51.9612	57.3186	47.8767	52.1733	59.9775	65.2556	57.8311	49.0185	53.7049	44.3638
54.6792	69.1687	57.8853	47.2477	54.9721	65.0396	52.8712	50.0907	56.3502	48.9877
49.9302	54.4948	48.9177	47.2236	55.4312	55.4035	47.8719	48.9987	54.1822	48.7194
52.4145	60.6976	47.6889	50.4476	54.754	61.9419	52.2681	49.8077	51.5351	49.1745
54.6123	57.687	48.3412	50.2354	54.3721	64.0001	56.7072	59.4147	48.3711	53.6999
52.8257	52.4232	59.5776	45.9766	55.422	65.8534	60.9808	46.9604	49.908	54.4638
53.7912	56.7506	51.307	49.874	52.794	55.6053	64.3793	50.1687	59.1313	58.948
55.1422	52.918	48.2615	51.4046	51.1954	65.8265	50.9044	49.2245	45.7925	55.7716
];

U_w_mat = [0.1	0.1	0.1	0.1	0.1	0.1	0.1	0.1	0.1	0.1
35.7984	28.6294	32.6601	27.5264	42.0352	35.6894	27.6251	34.7809	32.053	32.4584
43.4248	36.0222	59.0839	36.5276	49.3001	44.071	35.442	41.5541	39.7548	41.4584
50.9518	52.6698	55.677	43.5842	53.0965	51.1577	43.0347	49.679	47.0149	48.8038
47.1033	57.1394	51.9447	47.5798	50.1124	55.9378	44.5981	52.0859	51.7502	53.3628
45.6514	53.8815	56.3642	51.8588	50.8869	55.0222	49.2532	56.84	56.0791	52.4689
51.5353	50.553	52.801	51.7814	52.9037	54.3666	49.5843	53.6	52.7808	56.8048
54.2772	48.1292	56.1539	54.2234	52.151	52.9866	54.1942	57.73	53.5521	52.529
52.0431	53.104	52.2569	56.1177	53.4022	51.7797	55.2375	52.4087	54.2435	55.1664
52.8361	54.8848	56.3259	52.0894	49.7701	52.4335	55.6962	55.124	54.1485	51.944
53.7158	54.8263	58.2051	57.2122	53.8684	53.0302	53.195	59.7585	54.3441	55.8421
53.5229	53.0792	54.6278	56.1936	54.4975	52.0511	54.6601	53.5826	54.3908	52.669
53.2262	55.0348	55.7637	54.2044	54.9217	51.2375	53.6179	54.1563	50.9462	56.2407
53.3322	52.8368	55.5715	55.0035	51.9928	56.3102	54.767	50.2438	56.0115	51.5175
53.6249	55.16	58.0618	53.9512	54.9481	54.63	53.0125	56.0606	55.0885	55.3655
51.2706	52.0924	55.6321	54.2635	55.4593	50.9889	55.102	54.0873	54.628	55.4374
56.7607	54.7419	55.4542	56.4783	51.1194	55.9112	55.3366	53.5114	54.3714	53.7773
53.8504	55.3823	53.8985	55.8509	55.2368	55.8796	51.8825	53.5114	54.1007	53.8575
56.5112	56.8764	56.2751	52.394	53.8278	53.5572	56.0103	53.8305	54.4248	54.8661
51.4931	53.8087	53.6632	54.4029	58.4377	56.2567	51.7821	53.853	54.4404	52.7481
56.2807	52.5629	55.8625	51.2256	53.4699	54.2881	56.4753	50.778	54.6274	52.7481
53.9459	53.8438	55.0011	54.7418	55.8035	57.2041	53.9567	54.3077	54.8231	52.9976
51.5449	52.752	54.9009	51.4111	58.4422	53.6859	50.812	53.6224	53.4419	52.9811
56.1335	54.468	52.1832	53.3845	56.0554	55.2378	56.5016	53.877	49.7509	53.2308
52.9119	51.6066	56.9789	50.7677	55.0751	53.5322	52.1636	53.9162	53.0373	52.8681
55.8391	56.5294	54.2153	62.0359	56.1901	57.2101	57.0879	50.6704	49.6714	51.9839
52.4691	57.089	57.423	55.1769	52.9166	57.1001	54.0388	54.7816	55.0117	54.7147
55.4521	55.0407	53.044	51.6836	57.0977	55.535	57.6971	53.7037	52.7976	53.039
52.5613	51.2912	57.2676	55.6915	55.8971	57.5395	54.6585	53.884	57.9893	52.2004
54.5603	50.216	54.4203	55.3848	54.8959	55.7542	57.2971	52.1523	52.9605	53.9126
];

Pen_mat_wo = [];
Pen_mat_w = [];
figure()
hold on
for i=1:size(U_wo_mat,2)
    
    for j = 1:size(U_wo_mat,1)
        
        U(1) = U_wo_mat(j,i);
        Y0(3) = U(1);
        
        [T, Y_wo] = ode15s(pen_simulator,sampling, Y0, opt,U,K_sim,extra_var);
        
        U(1) = U_w_mat(j,i);
        Y0(3) = U(1);
        
        [T, Y_w] = ode15s(pen_simulator,sampling, Y0, opt,U,K_sim,extra_var);
        
        Pen_vec_wo(j) = Y_wo(end,2)*Y_wo(end,4);
        Pen_vec_w(j) = Y_w(end,2)*Y_w(end,4);
    end
    
    Pen_mat_wo = [Pen_mat_wo Pen_vec_wo'];
    Pen_mat_w = [Pen_mat_w Pen_vec_w'];
%     Pen_mat(1) = 50;
    plot(1:size(U_wo_mat,1),Pen_vec_wo,'b')
    plot(1:size(U_wo_mat,1),Pen_vec_w,'r')
end

Pen_mat_wo
Pen_mat_w





end